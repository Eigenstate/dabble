* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) VERSION on Jan, 12. 2015.
* GENERATES LIPID PACKING USING A BIG SPHERE
* 

DIMENS CHSIZE 2000000
!DIMENS CHSIZE 1000000

! Read topology and parameter files
stream toppar.str

! Read the system information
stream step3_size.str
stream step3_nlipids_upper.prm
stream step3_nlipids_lower.prm

! Read toppar for big-spheres (POL) 
stream step3_packing_pol.str

! Generate big-spheres (POL) for upper leaflet
read sequence POL @NLIPTOP
generate UPPO warn

! Generate big-spheres (POL) for lower leaflet
read sequence POL @NLIPBOT
generate DNPO warn

!
! Change resnames [upper leaflet]
!

calc cnt1 = 0
calc cnt2 = 0

if nchl1top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nchl1top - 1
   rename resname CHL1 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nergtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nergtop - 1
   rename resname ERG select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndlpatop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndlpatop - 1
   rename resname DLPA select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndmpatop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpatop - 1
   rename resname DMPA select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndppatop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndppatop - 1
   rename resname DPPA select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndspatop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndspatop - 1
   rename resname DSPA select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npopatop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopatop - 1
   rename resname POPA select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nplpatop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpatop - 1
   rename resname PLPA select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsopatop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsopatop - 1
   rename resname SOPA select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nslpatop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nslpatop - 1
   rename resname SLPA select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndxpatop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndxpatop - 1
   rename resname DXPA select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nyopatop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nyopatop - 1
   rename resname YOPA select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndopatop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndopatop - 1
   rename resname DOPA select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndgpatop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndgpatop - 1
   rename resname DGPA select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndepatop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndepatop - 1
   rename resname DEPA select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndnpatop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndnpatop - 1
   rename resname DNPA select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndlpctop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndlpctop - 1
   rename resname DLPC select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndmpctop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpctop - 1
   rename resname DMPC select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndppctop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndppctop - 1
   rename resname DPPC select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndspctop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndspctop - 1
   rename resname DSPC select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npopctop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopctop - 1
   rename resname POPC select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nplpctop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpctop - 1
   rename resname PLPC select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsopctop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsopctop - 1
   rename resname SOPC select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nslpctop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nslpctop - 1
   rename resname SLPC select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndypctop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndypctop - 1
   rename resname DYPC select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nyopctop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nyopctop - 1
   rename resname YOPC select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndopctop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndopctop - 1
   rename resname DOPC select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndgpctop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndgpctop - 1
   rename resname DGPC select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndepctop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndepctop - 1
   rename resname DEPC select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndnpctop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndnpctop - 1
   rename resname DNPC select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndlpetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndlpetop - 1
   rename resname DLPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndmpetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpetop - 1
   rename resname DMPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndppetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndppetop - 1
   rename resname DPPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndspetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndspetop - 1
   rename resname DSPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npypetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npypetop - 1
   rename resname PYPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npopetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopetop - 1
   rename resname POPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nplpetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpetop - 1
   rename resname PLPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsopetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsopetop - 1
   rename resname SOPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nslpetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nslpetop - 1
   rename resname SLPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndypetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndypetop - 1
   rename resname DYPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nyopetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nyopetop - 1
   rename resname YOPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nospetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nospetop - 1
   rename resname OSPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndopetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndopetop - 1
   rename resname DOPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndgpetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndgpetop - 1
   rename resname DGPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndepetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndepetop - 1
   rename resname DEPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndnpetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndnpetop - 1
   rename resname DNPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndlpgtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndlpgtop - 1
   rename resname DLPG select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndmpgtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpgtop - 1
   rename resname DMPG select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndppgtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndppgtop - 1
   rename resname DPPG select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndspgtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndspgtop - 1
   rename resname DSPG select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npspgtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npspgtop - 1
   rename resname PSPG select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npopgtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopgtop - 1
   rename resname POPG select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nplpgtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpgtop - 1
   rename resname PLPG select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsopgtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsopgtop - 1
   rename resname SOPG select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nslpgtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nslpgtop - 1
   rename resname SLPG select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndxpgtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndxpgtop - 1
   rename resname DXPG select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndopgtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndopgtop - 1
   rename resname DOPG select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndgpgtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndgpgtop - 1
   rename resname DGPG select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndepgtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndepgtop - 1
   rename resname DEPG select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndnpgtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndnpgtop - 1
   rename resname DNPG select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndlpstop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndlpstop - 1
   rename resname DLPS select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndmpstop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpstop - 1
   rename resname DMPS select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndppstop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndppstop - 1
   rename resname DPPS select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndspstop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndspstop - 1
   rename resname DSPS select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npopstop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopstop - 1
   rename resname POPS select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nplpstop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpstop - 1
   rename resname PLPS select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsopstop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsopstop - 1
   rename resname SOPS select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nslpstop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nslpstop - 1
   rename resname SLPS select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndxpstop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndxpstop - 1
   rename resname DXPS select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nyopstop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nyopstop - 1
   rename resname YOPS select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndopstop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndopstop - 1
   rename resname DOPS select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndgpstop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndgpstop - 1
   rename resname DGPS select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndepstop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndepstop - 1
   rename resname DEPS select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndnpstop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndnpstop - 1
   rename resname DNPS select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndmpitop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpitop - 1
   rename resname DMPI select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndmpi13top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpi13top - 1
   rename resname DMPI13 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndmpi14top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpi14top - 1
   rename resname DMPI14 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndmpi15top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpi15top - 1
   rename resname DMPI15 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndmpi24top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpi24top - 1
   rename resname DMPI24 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndmpi25top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpi25top - 1
   rename resname DMPI25 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndmpi33top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpi33top - 1
   rename resname DMPI33 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndmpi34top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpi34top - 1
   rename resname DMPI34 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndmpi35top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpi35top - 1
   rename resname DMPI35 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npypitop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npypitop - 1
   rename resname PYPI select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npopitop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopitop - 1
   rename resname POPI select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npopi13top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopi13top - 1
   rename resname POPI13 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npopi14top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopi14top - 1
   rename resname POPI14 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npopi15top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopi15top - 1
   rename resname POPI15 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npopi24top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopi24top - 1
   rename resname POPI24 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npopi25top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopi25top - 1
   rename resname POPI25 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npopi33top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopi33top - 1
   rename resname POPI33 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npopi34top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopi34top - 1
   rename resname POPI34 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npopi35top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopi35top - 1
   rename resname POPI35 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nplpitop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpitop - 1
   rename resname PLPI select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nplpi13top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpi13top - 1
   rename resname PLPI13 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nplpi14top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpi14top - 1
   rename resname PLPI14 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nplpi15top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpi15top - 1
   rename resname PLPI15 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nplpi24top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpi24top - 1
   rename resname PLPI24 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nplpi25top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpi25top - 1
   rename resname PLPI25 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nplpi33top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpi33top - 1
   rename resname PLPI33 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nplpi34top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpi34top - 1
   rename resname PLPI34 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nplpi35top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpi35top - 1
   rename resname PLPI35 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npnpitop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npnpitop - 1
   rename resname PNPI select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npnpi13top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npnpi13top - 1
   rename resname PNPI13 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npnpi14top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npnpi14top - 1
   rename resname PNPI14 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npnpi15top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npnpi15top - 1
   rename resname PNPI15 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npnpi24top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npnpi24top - 1
   rename resname PNPI24 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npnpi25top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npnpi25top - 1
   rename resname PNPI25 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npnpi33top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npnpi33top - 1
   rename resname PNPI33 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npnpi34top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npnpi34top - 1
   rename resname PNPI34 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npnpi35top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npnpi35top - 1
   rename resname PNPI35 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsapitop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapitop - 1
   rename resname SAPI select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsapi13top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapi13top - 1
   rename resname SAPI13 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsapi14top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapi14top - 1
   rename resname SAPI14 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsapi15top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapi15top - 1
   rename resname SAPI15 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsapi24top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapi24top - 1
   rename resname SAPI24 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsapi25top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapi25top - 1
   rename resname SAPI25 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsapi33top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapi33top - 1
   rename resname SAPI33 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsapi34top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapi34top - 1
   rename resname SAPI34 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsapi35top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapi35top - 1
   rename resname SAPI35 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ntmcl1top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ntmcl1top - 1
   rename resname TMCL1 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ntmcl2top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ntmcl2top - 1
   rename resname TMCL2 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npmcl1top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npmcl1top - 1
   rename resname PMCL1 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npmcl2top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npmcl2top - 1
   rename resname PMCL2 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npvcl2top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npvcl2top - 1
   rename resname PVCL2 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ntxcl1top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ntxcl1top - 1
   rename resname TXCL1 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ntxcl2top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ntxcl2top - 1
   rename resname TXCL2 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ntocl1top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ntocl1top - 1
   rename resname TOCL1 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ntocl2top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ntocl2top - 1
   rename resname TOCL2 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nloacl1top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nloacl1top - 1
   rename resname LOACL1 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nloacl2top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nloacl2top - 1
   rename resname LOACL2 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nloccl1top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nloccl1top - 1
   rename resname LOCCL1 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nloccl2top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nloccl2top - 1
   rename resname LOCCL2 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ntlcl1top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ntlcl1top - 1
   rename resname TLCL1 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ntlcl2top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ntlcl2top - 1
   rename resname TLCL2 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nlnccl1top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nlnccl1top - 1
   rename resname LNCCL1 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nlnccl2top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nlnccl2top - 1
   rename resname LNCCL2 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nlnacl1top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nlnacl1top - 1
   rename resname LNACL1 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nlnacl2top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nlnacl2top - 1
   rename resname LNACL2 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nlndcl1top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nlndcl1top - 1
   rename resname LNDCL1 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nlndcl2top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nlndcl2top - 1
   rename resname LNDCL2 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nlnbcl1top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nlnbcl1top - 1
   rename resname LNBCL1 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nlnbcl2top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nlnbcl2top - 1
   rename resname LNBCL2 select segid UPPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsapatop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapatop - 1
   rename resname SAPA select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsapctop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapctop - 1
   rename resname SAPC select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsapetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapetop - 1
   rename resname SAPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsapgtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapgtop - 1
   rename resname SAPG select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsapstop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapstop - 1
   rename resname SAPS select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsdpatop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsdpatop - 1
   rename resname SDPA select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsdpctop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsdpctop - 1
   rename resname SDPC select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsdpetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsdpetop - 1
   rename resname SDPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsdpgtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsdpgtop - 1
   rename resname SDPG select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nsdpstop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsdpstop - 1
   rename resname SDPS select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndapatop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndapatop - 1
   rename resname DAPA select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndapctop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndapctop - 1
   rename resname DAPC select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndapetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndapetop - 1
   rename resname DAPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndapgtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndapgtop - 1
   rename resname DAPG select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ndapstop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndapstop - 1
   rename resname DAPS select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npsmtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npsmtop - 1
   rename resname PSM select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nssmtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nssmtop - 1
   rename resname SSM select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nasmtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nasmtop - 1
   rename resname ASM select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nbsmtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nbsmtop - 1
   rename resname BSM select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if n23smtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @n23smtop - 1
   rename resname 23SM select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nlsmtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nlsmtop - 1
   rename resname LSM select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nosmtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nosmtop - 1
   rename resname OSM select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nnsmtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nnsmtop - 1
   rename resname NSM select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ncer160top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ncer160top - 1
   rename resname CER160 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ncer180top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ncer180top - 1
   rename resname CER180 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ncer181top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ncer181top - 1
   rename resname CER181 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ncer200top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ncer200top - 1
   rename resname CER200 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ncer220top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ncer220top - 1
   rename resname CER220 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ncer240top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ncer240top - 1
   rename resname CER240 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if ncer241top .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ncer241top - 1
   rename resname CER241 select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nqmpetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nqmpetop - 1
   rename resname QMPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npmpetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npmpetop - 1
   rename resname PMPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npmpgtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npmpgtop - 1
   rename resname PMPG select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npppetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npppetop - 1
   rename resname PPPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npvpetop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npvpetop - 1
   rename resname PVPE select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if npvpgtop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npvpgtop - 1
   rename resname PVPG select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nappctop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nappctop - 1
   rename resname APPC select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nippctop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nippctop - 1
   rename resname IPPC select segid UPPO .and. resid @cnt1:@cnt2 end
endif
if nphpctop .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nphpctop - 1
   rename resname PHPC select segid UPPO .and. resid @cnt1:@cnt2 end
endif

!
! Change resnames [lower leaflet]
!

calc cnt1 = 0
calc cnt2 = 0

if nchl1bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nchl1bot - 1
   rename resname CHL1 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nergbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nergbot - 1
   rename resname ERG select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndlpabot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndlpabot - 1
   rename resname DLPA select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndmpabot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpabot - 1
   rename resname DMPA select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndppabot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndppabot - 1
   rename resname DPPA select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndspabot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndspabot - 1
   rename resname DSPA select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npopabot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopabot - 1
   rename resname POPA select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nplpabot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpabot - 1
   rename resname PLPA select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsopabot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsopabot - 1
   rename resname SOPA select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nslpabot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nslpabot - 1
   rename resname SLPA select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndxpabot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndxpabot - 1
   rename resname DXPA select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nyopabot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nyopabot - 1
   rename resname YOPA select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndopabot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndopabot - 1
   rename resname DOPA select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndgpabot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndgpabot - 1
   rename resname DGPA select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndepabot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndepabot - 1
   rename resname DEPA select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndnpabot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndnpabot - 1
   rename resname DNPA select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndlpcbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndlpcbot - 1
   rename resname DLPC select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndmpcbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpcbot - 1
   rename resname DMPC select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndppcbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndppcbot - 1
   rename resname DPPC select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndspcbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndspcbot - 1
   rename resname DSPC select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npopcbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopcbot - 1
   rename resname POPC select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nplpcbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpcbot - 1
   rename resname PLPC select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsopcbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsopcbot - 1
   rename resname SOPC select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nslpcbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nslpcbot - 1
   rename resname SLPC select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndypcbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndypcbot - 1
   rename resname DYPC select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nyopcbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nyopcbot - 1
   rename resname YOPC select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndopcbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndopcbot - 1
   rename resname DOPC select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndgpcbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndgpcbot - 1
   rename resname DGPC select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndepcbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndepcbot - 1
   rename resname DEPC select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndnpcbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndnpcbot - 1
   rename resname DNPC select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndlpebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndlpebot - 1
   rename resname DLPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndmpebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpebot - 1
   rename resname DMPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndppebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndppebot - 1
   rename resname DPPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndspebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndspebot - 1
   rename resname DSPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npypebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npypebot - 1
   rename resname PYPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npopebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopebot - 1
   rename resname POPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nplpebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpebot - 1
   rename resname PLPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsopebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsopebot - 1
   rename resname SOPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nslpebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nslpebot - 1
   rename resname SLPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndypebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndypebot - 1
   rename resname DYPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nyopebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nyopebot - 1
   rename resname YOPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nospebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nospebot - 1
   rename resname OSPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndopebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndopebot - 1
   rename resname DOPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndgpebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndgpebot - 1
   rename resname DGPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndepebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndepebot - 1
   rename resname DEPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndnpebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndnpebot - 1
   rename resname DNPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndlpgbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndlpgbot - 1
   rename resname DLPG select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndmpgbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpgbot - 1
   rename resname DMPG select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndppgbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndppgbot - 1
   rename resname DPPG select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndspgbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndspgbot - 1
   rename resname DSPG select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npspgbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npspgbot - 1
   rename resname PSPG select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npopgbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopgbot - 1
   rename resname POPG select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nplpgbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpgbot - 1
   rename resname PLPG select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsopgbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsopgbot - 1
   rename resname SOPG select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nslpgbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nslpgbot - 1
   rename resname SLPG select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndxpgbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndxpgbot - 1
   rename resname DXPG select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndopgbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndopgbot - 1
   rename resname DOPG select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndgpgbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndgpgbot - 1
   rename resname DGPG select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndepgbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndepgbot - 1
   rename resname DEPG select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndnpgbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndnpgbot - 1
   rename resname DNPG select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndlpsbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndlpsbot - 1
   rename resname DLPS select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndmpsbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpsbot - 1
   rename resname DMPS select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndppsbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndppsbot - 1
   rename resname DPPS select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndspsbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndspsbot - 1
   rename resname DSPS select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npopsbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopsbot - 1
   rename resname POPS select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nplpsbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpsbot - 1
   rename resname PLPS select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsopsbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsopsbot - 1
   rename resname SOPS select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nslpsbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nslpsbot - 1
   rename resname SLPS select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndxpsbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndxpsbot - 1
   rename resname DXPS select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nyopsbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nyopsbot - 1
   rename resname YOPS select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndopsbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndopsbot - 1
   rename resname DOPS select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndgpsbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndgpsbot - 1
   rename resname DGPS select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndepsbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndepsbot - 1
   rename resname DEPS select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndnpsbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndnpsbot - 1
   rename resname DNPS select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndmpibot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpibot - 1
   rename resname DMPI select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndmpi13bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpi13bot - 1
   rename resname DMPI13 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndmpi14bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpi14bot - 1
   rename resname DMPI14 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndmpi15bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpi15bot - 1
   rename resname DMPI15 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndmpi24bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpi24bot - 1
   rename resname DMPI24 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndmpi25bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpi25bot - 1
   rename resname DMPI25 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndmpi33bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpi33bot - 1
   rename resname DMPI33 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndmpi34bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpi34bot - 1
   rename resname DMPI34 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndmpi35bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndmpi35bot - 1
   rename resname DMPI35 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npypibot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npypibot - 1
   rename resname PYPI select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npopibot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopibot - 1
   rename resname POPI select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npopi13bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopi13bot - 1
   rename resname POPI13 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npopi14bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopi14bot - 1
   rename resname POPI14 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npopi15bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopi15bot - 1
   rename resname POPI15 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npopi24bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopi24bot - 1
   rename resname POPI24 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npopi25bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopi25bot - 1
   rename resname POPI25 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npopi33bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopi33bot - 1
   rename resname POPI33 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npopi34bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopi34bot - 1
   rename resname POPI34 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npopi35bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npopi35bot - 1
   rename resname POPI35 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nplpibot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpibot - 1
   rename resname PLPI select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nplpi13bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpi13bot - 1
   rename resname PLPI13 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nplpi14bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpi14bot - 1
   rename resname PLPI14 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nplpi15bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpi15bot - 1
   rename resname PLPI15 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nplpi24bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpi24bot - 1
   rename resname PLPI24 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nplpi25bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpi25bot - 1
   rename resname PLPI25 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nplpi33bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpi33bot - 1
   rename resname PLPI33 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nplpi34bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpi34bot - 1
   rename resname PLPI34 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nplpi35bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nplpi35bot - 1
   rename resname PLPI35 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npnpibot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npnpibot - 1
   rename resname PNPI select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npnpi13bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npnpi13bot - 1
   rename resname PNPI13 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npnpi14bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npnpi14bot - 1
   rename resname PNPI14 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npnpi15bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npnpi15bot - 1
   rename resname PNPI15 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npnpi24bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npnpi24bot - 1
   rename resname PNPI24 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npnpi25bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npnpi25bot - 1
   rename resname PNPI25 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npnpi33bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npnpi33bot - 1
   rename resname PNPI33 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npnpi34bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npnpi34bot - 1
   rename resname PNPI34 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npnpi35bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npnpi35bot - 1
   rename resname PNPI35 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsapibot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapibot - 1
   rename resname SAPI select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsapi13bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapi13bot - 1
   rename resname SAPI13 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsapi14bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapi14bot - 1
   rename resname SAPI14 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsapi15bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapi15bot - 1
   rename resname SAPI15 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsapi24bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapi24bot - 1
   rename resname SAPI24 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsapi25bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapi25bot - 1
   rename resname SAPI25 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsapi33bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapi33bot - 1
   rename resname SAPI33 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsapi34bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapi34bot - 1
   rename resname SAPI34 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsapi35bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapi35bot - 1
   rename resname SAPI35 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ntmcl1bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ntmcl1bot - 1
   rename resname TMCL1 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ntmcl2bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ntmcl2bot - 1
   rename resname TMCL2 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npmcl1bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npmcl1bot - 1
   rename resname PMCL1 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npmcl2bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npmcl2bot - 1
   rename resname PMCL2 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npvcl2bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npvcl2bot - 1
   rename resname PVCL2 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ntxcl1bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ntxcl1bot - 1
   rename resname TXCL1 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ntxcl2bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ntxcl2bot - 1
   rename resname TXCL2 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ntocl1bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ntocl1bot - 1
   rename resname TOCL1 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ntocl2bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ntocl2bot - 1
   rename resname TOCL2 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nloacl1bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nloacl1bot - 1
   rename resname LOACL1 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nloacl2bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nloacl2bot - 1
   rename resname LOACL2 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nloccl1bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nloccl1bot - 1
   rename resname LOCCL1 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nloccl2bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nloccl2bot - 1
   rename resname LOCCL2 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ntlcl1bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ntlcl1bot - 1
   rename resname TLCL1 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ntlcl2bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ntlcl2bot - 1
   rename resname TLCL2 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nlnccl1bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nlnccl1bot - 1
   rename resname LNCCL1 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nlnccl2bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nlnccl2bot - 1
   rename resname LNCCL2 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nlnacl1bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nlnacl1bot - 1
   rename resname LNACL1 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nlnacl2bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nlnacl2bot - 1
   rename resname LNACL2 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nlndcl1bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nlndcl1bot - 1
   rename resname LNDCL1 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nlndcl2bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nlndcl2bot - 1
   rename resname LNDCL2 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nlnbcl1bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nlnbcl1bot - 1
   rename resname LNBCL1 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nlnbcl2bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nlnbcl2bot - 1
   rename resname LNBCL2 select segid DNPO .and. resid @cnt1:@cnt2 end
   scalar type set 499 sele segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsapabot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapabot - 1
   rename resname SAPA select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsapcbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapcbot - 1
   rename resname SAPC select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsapebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapebot - 1
   rename resname SAPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsapgbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapgbot - 1
   rename resname SAPG select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsapsbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsapsbot - 1
   rename resname SAPS select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsdpabot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsdpabot - 1
   rename resname SDPA select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsdpcbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsdpcbot - 1
   rename resname SDPC select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsdpebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsdpebot - 1
   rename resname SDPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsdpgbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsdpgbot - 1
   rename resname SDPG select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nsdpsbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nsdpsbot - 1
   rename resname SDPS select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndapabot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndapabot - 1
   rename resname DAPA select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndapcbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndapcbot - 1
   rename resname DAPC select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndapebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndapebot - 1
   rename resname DAPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndapgbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndapgbot - 1
   rename resname DAPG select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ndapsbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ndapsbot - 1
   rename resname DAPS select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npsmbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npsmbot - 1
   rename resname PSM select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nssmbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nssmbot - 1
   rename resname SSM select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nasmbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nasmbot - 1
   rename resname ASM select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nbsmbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nbsmbot - 1
   rename resname BSM select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if n23smbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @n23smbot - 1
   rename resname 23SM select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nlsmbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nlsmbot - 1
   rename resname LSM select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nosmbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nosmbot - 1
   rename resname OSM select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nnsmbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nnsmbot - 1
   rename resname NSM select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ncer160bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ncer160bot - 1
   rename resname CER160 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ncer180bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ncer180bot - 1
   rename resname CER180 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ncer181bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ncer181bot - 1
   rename resname CER181 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ncer200bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ncer200bot - 1
   rename resname CER200 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ncer220bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ncer220bot - 1
   rename resname CER220 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ncer240bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ncer240bot - 1
   rename resname CER240 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if ncer241bot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @ncer241bot - 1
   rename resname CER241 select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nqmpebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nqmpebot - 1
   rename resname QMPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npmpebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npmpebot - 1
   rename resname PMPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npmpgbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npmpgbot - 1
   rename resname PMPG select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npppebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npppebot - 1
   rename resname PPPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npvpebot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npvpebot - 1
   rename resname PVPE select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if npvpgbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @npvpgbot - 1
   rename resname PVPG select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nappcbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nappcbot - 1
   rename resname APPC select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nippcbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nippcbot - 1
   rename resname IPPC select segid DNPO .and. resid @cnt1:@cnt2 end
endif
if nphpcbot .gt. 0 then
   calc cnt1 = @cnt2 + 1
   calc cnt2 = @cnt1 + @nphpcbot - 1
   rename resname PHPC select segid DNPO .and. resid @cnt1:@cnt2 end
endif

! charged lipids
scalar charge set -1 sele resname dlpa end
scalar charge set -1 sele resname dmpa end
scalar charge set -1 sele resname dppa end
scalar charge set -1 sele resname dspa end
scalar charge set -1 sele resname popa end
scalar charge set -1 sele resname plpa end
scalar charge set -1 sele resname sopa end
scalar charge set -1 sele resname slpa end
scalar charge set -1 sele resname dxpa end
scalar charge set -1 sele resname yopa end
scalar charge set -1 sele resname dopa end
scalar charge set -1 sele resname dgpa end
scalar charge set -1 sele resname depa end
scalar charge set -1 sele resname dnpa end
scalar charge set -1 sele resname dlpg end
scalar charge set -1 sele resname dmpg end
scalar charge set -1 sele resname dppg end
scalar charge set -1 sele resname dspg end
scalar charge set -1 sele resname pspg end
scalar charge set -1 sele resname popg end
scalar charge set -1 sele resname plpg end
scalar charge set -1 sele resname sopg end
scalar charge set -1 sele resname slpg end
scalar charge set -1 sele resname dxpg end
scalar charge set -1 sele resname dopg end
scalar charge set -1 sele resname dgpg end
scalar charge set -1 sele resname depg end
scalar charge set -1 sele resname dnpg end
scalar charge set -1 sele resname dlps end
scalar charge set -1 sele resname dmps end
scalar charge set -1 sele resname dpps end
scalar charge set -1 sele resname dsps end
scalar charge set -1 sele resname pops end
scalar charge set -1 sele resname plps end
scalar charge set -1 sele resname sops end
scalar charge set -1 sele resname slps end
scalar charge set -1 sele resname dxps end
scalar charge set -1 sele resname yops end
scalar charge set -1 sele resname dops end
scalar charge set -1 sele resname dgps end
scalar charge set -1 sele resname deps end
scalar charge set -1 sele resname dnps end
scalar charge set -1 sele resname dmpi end
scalar charge set -3 sele resname dmpi13 end
scalar charge set -3 sele resname dmpi14 end
scalar charge set -3 sele resname dmpi15 end
scalar charge set -4 sele resname dmpi24 end
scalar charge set -4 sele resname dmpi25 end
scalar charge set -6 sele resname dmpi33 end
scalar charge set -6 sele resname dmpi34 end
scalar charge set -6 sele resname dmpi35 end
scalar charge set -1 sele resname pypi end
scalar charge set -1 sele resname popi end
scalar charge set -3 sele resname popi13 end
scalar charge set -3 sele resname popi14 end
scalar charge set -3 sele resname popi15 end
scalar charge set -4 sele resname popi24 end
scalar charge set -4 sele resname popi25 end
scalar charge set -6 sele resname popi33 end
scalar charge set -6 sele resname popi34 end
scalar charge set -6 sele resname popi35 end
scalar charge set -1 sele resname plpi end
scalar charge set -3 sele resname plpi13 end
scalar charge set -3 sele resname plpi14 end
scalar charge set -3 sele resname plpi15 end
scalar charge set -4 sele resname plpi24 end
scalar charge set -4 sele resname plpi25 end
scalar charge set -6 sele resname plpi33 end
scalar charge set -6 sele resname plpi34 end
scalar charge set -6 sele resname plpi35 end
scalar charge set -1 sele resname pnpi end
scalar charge set -3 sele resname pnpi13 end
scalar charge set -3 sele resname pnpi14 end
scalar charge set -3 sele resname pnpi15 end
scalar charge set -4 sele resname pnpi24 end
scalar charge set -4 sele resname pnpi25 end
scalar charge set -6 sele resname pnpi33 end
scalar charge set -6 sele resname pnpi34 end
scalar charge set -6 sele resname pnpi35 end
scalar charge set -1 sele resname sapi end
scalar charge set -3 sele resname sapi13 end
scalar charge set -3 sele resname sapi14 end
scalar charge set -3 sele resname sapi15 end
scalar charge set -4 sele resname sapi24 end
scalar charge set -4 sele resname sapi25 end
scalar charge set -6 sele resname sapi33 end
scalar charge set -6 sele resname sapi34 end
scalar charge set -6 sele resname sapi35 end
scalar charge set -1 sele resname tmcl1 end
scalar charge set -2 sele resname tmcl2 end
scalar charge set -1 sele resname pmcl1 end
scalar charge set -2 sele resname pmcl2 end
scalar charge set -2 sele resname pvcl2 end
scalar charge set -1 sele resname txcl1 end
scalar charge set -2 sele resname txcl2 end
scalar charge set -1 sele resname tocl1 end
scalar charge set -2 sele resname tocl2 end
scalar charge set -1 sele resname loacl1 end
scalar charge set -2 sele resname loacl2 end
scalar charge set -1 sele resname loccl1 end
scalar charge set -2 sele resname loccl2 end
scalar charge set -1 sele resname tlcl1 end
scalar charge set -2 sele resname tlcl2 end
scalar charge set -1 sele resname lnccl1 end
scalar charge set -2 sele resname lnccl2 end
scalar charge set -1 sele resname lnacl1 end
scalar charge set -2 sele resname lnacl2 end
scalar charge set -1 sele resname lndcl1 end
scalar charge set -2 sele resname lndcl2 end
scalar charge set -1 sele resname lnbcl1 end
scalar charge set -2 sele resname lnbcl2 end
scalar charge set -1 sele resname sapa end
scalar charge set -1 sele resname sapg end
scalar charge set -1 sele resname saps end
scalar charge set -1 sele resname sdpa end
scalar charge set -1 sele resname sdpg end
scalar charge set -1 sele resname sdps end
scalar charge set -1 sele resname dapa end
scalar charge set -1 sele resname dapg end
scalar charge set -1 sele resname daps end
scalar charge set -1 sele resname pmpg end
scalar charge set -1 sele resname pvpg end

! First, guess available regions for initial positions of the big-spheres (150%)
calc Ainit = @A * 1.5
calc Binit = @B * 1.5

! Define the boundary for non-accessible regions of the big-spheres
define uppo sele ( .not. ( segid UPPO .or. segid DNPO ) ) .and. ( prop Z .gt.  10 ) .and. (prop Z .lt.  20 ) end
if ?nsel .gt. 0 then
   coor stat sele uppo end
   calc xpup = ?xmax
   calc xnup = ?xmin
   calc ypup = ?ymax
   calc ynup = ?ymin
else
   calc xpup = 0
   calc xnup = 0
   calc ypup = 0
   calc ynup = 0
endif

define dnpo sele ( .not. ( segid UPPO .or. segid DNPO ) ) .and. ( prop Z .gt. -20 ) .and. (prop Z .lt. -10 ) end
if ?nsel .gt. 0 then
   coor stat sele dnpo end
   calc xpdn = ?xmax
   calc xndn = ?xmin
   calc ypdn = ?ymax
   calc yndn = ?ymin
else
   calc xpdn = 0
   calc xndn = 0
   calc ypdn = 0
   calc yndn = 0
endif

! to prevent infinite-loop
calc A2 = @A/2
calc B2 = @A/2
if xpup .gt.  @A2 stop
if xnup .lt. -@A2 stop
if ypup .gt.  @B2 stop
if ynup .lt. -@B2 stop
if xpdn .gt.  @A2 stop
if xndn .lt. -@A2 stop
if ypdn .gt.  @B2 stop
if yndn .lt. -@B2 stop

!----------------------------------------------------------------------
! Put big-spheres molecules at random positions

! Random number generation
RAND UNIF ISEED 1421096804 SCALE 1.0

calc i = 1

label do_up

  label rand_up
  calc xpos = ?random
  calc ypos = ?random
  calc xpos = @Ainit * ( @xpos - 0.5 )
  if xpos .gt. @xnup if xpos .lt. @xpup goto rand_up
  calc ypos = @Binit * ( @ypos - 0.5 )
  if ypos .gt. @ynup if ypos .lt. @ypup goto rand_up
  calc zpos = 12.0 

  coor set xdir @xpos  ydir @ypos  zdir @zpos select segid UPPO .and. resid @i end

  MMFP
  GEO plane  RCM -
      xref 0.0  yref 0.0  zref  @zpos  zdir 1.0 -
      force  100.0   select segid UPPO .and. resi @i end
  END

incr i by 1
if i le @NLIPTOP goto do_up


calc i = 1

label do_dn

  label rand_dn
  calc xpos = ?random
  calc ypos = ?random
  calc xpos = @Ainit * ( @xpos - 0.5 )
  if xpos .gt. @xndn if xpos .lt. @xpdn goto rand_dn
  calc ypos = @Binit * ( @ypos - 0.5 )
  if ypos .gt. @yndn if ypos .lt. @ypdn goto rand_dn
  calc zpos = -12.0 

  coor set xdir @xpos  ydir @ypos  zdir @zpos select segid DNPO .and. resid @i end

  MMFP
  GEO plane  RCM -
      xref 0.0  yref 0.0  zref  @zpos  zdir 1.0 -
      force  100.0   select segid DNPO .and. resi @i end
  END

incr i by 1
if i le @NLIPBOT goto do_dn

rename SEGid HEAD sele segid UPPO end
join HEAD DNPO renumber

!------------------------------------------------------------------------------
! Build the Periodic Boundary Conditions and
! Carry out Minimization and Dynamics for Equilibration of Large Spheres
! 6 cycles to reduce the Ainit and Binit back to original A and B

cons fix sele .not. segid HEAD end

! LD simulation steps depend on the number of lipid spheres
calc nstep = int ( ( @NLIPTOP + @NLIPBOT ) * 4 / 1000 + 1 ) * 1000

set i = 5

label do_packing

calc Ainit = @A * 1.@i
calc Binit = @B * 1.@i

if i .ne. 5 crystal free
crystal define @xtltype @Ainit @Binit 10000.0 @Alpha @beta @Gamma

open read unit 10 card name crystal_image.str
crystal read unit 10 card
close unit 10

image byresid xcen 0.0 ycen 0.0 zcen 0.0 sele segid HEAD end

!setup nonbond option (eps=80)
nbonds atom switch cdie vdw vfswitch  -
       ctonnb 20.0 ctofnb 22.0 cutnb 26.0 cutim 26.0 -
       inbfrq -1 imgfrq -1 wmin 1.0 cdie eps 80.0

ENERGY

mini sd   nstep 200    nprint 10
mini abnr nstep 200    nprint 10

scalar fbeta set  10.0 select all end

DYNAMICS  start       nstep   @nstep  timestp  0.001 iprfrq   1000  nprint 100  -
          iasvel    1 firstt 300.0  finalt   300.0 tstruc  300.0  -
          langevin    tbath  300.0  rbuf       0.0 -
          inbfrq   -1 imgfrq    -1  ihbfrq       0 ilbfrq      0  -
          iunread  -1  -
          iunwrite -1  -
          iuncrd   -1 nsavcrd    0  -
          iunvelo  -1 nsavvelo   0  -
          kunit    -1  

decrease i by 1
if i .ge. 0 goto do_packing

updat cutim 35.0 imall

open write card unit 1 name step3_packing.pdb
write coor pdb  unit 1 image
close unit 1

!
! HEAD ONLY
!

crystal free
define junk sele .not. segid HEAD end
if ?nsel .ne. 0 delete atom sele junk end

open write card unit 10 name step3_packing_head.crd
write coor card unit 10 

open write card unit 10 name step3_packing_head.pdb
write coor pdb  unit 10 

open write unit 10 card name step3_packing_head.psf
write psf  unit 10 card

stop