* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) VERSION on Jan, 12. 2015.
* TEST AND FIX CHOLESTEROL RING PENERTRATION
*

bomlev -5

DIMENS CHSIZE 2000000
!DIMENS CHSIZE 1000000

! Read topology and parameter files
stream toppar.str

! Read the system information
stream step3_size.str
stream step3_nlipids_upper.prm
stream step3_nlipids_lower.prm

! Read Lipids
open read card unit 10 name step4_lipid_lipid.crd
read sequence coor card unit 10
generate MEMB warn first none last none

open read unit 10 card name step4_lipid_lipid.crd
read coor unit 10 card resid

!
! Image Setup
!

open read unit 10 card name crystal_image.str
CRYSTAL DEFINE @XTLtype @A @B @C @alpha @beta @gamma
CRYSTAL READ UNIT 10 CARD

!Image centering by residue
IMAGE BYRESID XCEN 0.0 YCEN 0.0 ZCEN @zcen sele resname TIP3 .or. segid MEMB end

!
! Nonbonded Options
!

nbonds atom vatom vfswitch bycb -
       ctonnb 6.0 ctofnb 7.0 cutnb 10.0 cutim 10.0 -
       inbfrq -1 imgfrq -1 wmin 1.0 cdie eps 1.0 
energy

!
! Minimization 
!

mini sd   nstep 250
mini abnr nstep 250

!
! check lipid penetrating into cholesterol rings
!

open write unit 90 card name step4_lipid_checkchol.str

!loop for upper-leaflet CHL1 and ERG
coor stat sele ( resname CHL1 .or. resname ERG ) .and. type O3 .and. ( prop Z .gt. 0 ) end
calc i    = ?SELIRES
calc iend = @i + @nchl1top - 1
calc iend = @i + @nergtop - 1

label dointer1
  inter select resid @i .and. segid MEMB end

  if ?bond .gt. 100 then
    write title unit 90
    * @i
    *
  endif

increase i by 1
if i .le. @iend goto dointer1

!loop for bottom-leaflet CHL1 and ERG
coor stat sele resname CHL1 .and. type O3 .and. ( prop Z .lt. 0 ) end
calc i    = ?SELIRES
calc iend = @i + @nchl1bot - 1
calc iend = @i + @nergbot - 1

label dointer2
  inter select resid @i .and. segid MEMB end

  if ?bond .gt. 100 then
    write title unit 90
    * @i
    *
  endif

increase i by 1
if i .le. @iend goto dointer2

stop