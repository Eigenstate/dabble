* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) VERSION on Jan, 12. 2015.
* DIHEDRAL RESTRAINT POTENTIALS FOR CARBOHYDRATES
*

coor stat sele all end
set natom = ?nsel

define XXX sele ( resn *GLC* .or. resn *GAL*  .or. resn *ALT .or. resn *ALL .or. resn *GUL .or. -
                  resn *IDO* .or. resn *MAN   .or. resn *TAL .or. resn *XYL .or. resn *FUC .or. -
                  resn *RHM  .or. resn *NE5AC .or. resn HEP* .or. resn KDO ) .and. -
                ( chem OC3C61 ) show end

set cntmax = ?nsel
if cntmax .eq. 0 goto skipcarb

open write card unit 54 name openmm/restraints/carbohydrate_restraint.dat

define JUNK sele segid ?selsegi .and. resid ?selresi end
set iatom = ?selatom

set icnt = 1
label DOCARB

   if iatom .gt. @natom goto skipcarb

   define YYY sele XXX .and. bynu @iatom:@natom end
   set segid = ?selsegi
   set resid = ?selresi
   set resn  = ?selresn

   define JUNK sele segid @segid .and. resid @resid show end
   set iatom = ?selatom
   set nresatom = ?nsel

   set issialic = no
   set iskdo    = no
   if resn .eq. ANE5AC set issialic = yes
   if resn .eq. BNE5AC set issialic = yes
   if resn .eq. KDO    set iskdo    = yes

!
! Sialic acid chair conformation
!

   if issialic .eq. yes then

      coor stat sele JUNK .and. type O6 end
      set atom0 = ?selatom
      coor stat sele JUNK .and. type C2 end
      set atom1 = ?selatom
      coor stat sele JUNK .and. type C3 end
      set atom2 = ?selatom
      coor stat sele JUNK .and. type C4 end
      set atom3 = ?selatom
      coor stat sele JUNK .and. type C5 end
      set atom4 = ?selatom
      coor stat sele JUNK .and. type C6 end
      set atom5 = ?selatom

      calc index0 = @atom0 - 1
      calc index1 = @atom1 - 1
      calc index2 = @atom2 - 1
      calc index3 = @atom3 - 1
      calc index4 = @atom4 - 1
      calc index5 = @atom5 - 1

      write title unit 54
      * @index0 @index1 @index2 @index3 -60.0 2.5
      * @index1 @index2 @index3 @index4 60.0 2.5
      * @index2 @index3 @index4 @index5 -60.0 2.5
      * @index3 @index4 @index5 @index0 60.0 2.5
      * @index4 @index5 @index0 @index1 -60.0 2.5
      * @index5 @index0 @index1 @index2 60.0 2.5
      *
      
      goto donext
   endif

!
! KDO chair conformation
!

   if iskdo .eq. yes then

      coor stat sele JUNK .and. type O6 end
      set atom0 = ?selatom
      coor stat sele JUNK .and. type C2 end
      set atom1 = ?selatom
      coor stat sele JUNK .and. type C3 end
      set atom2 = ?selatom
      coor stat sele JUNK .and. type C4 end
      set atom3 = ?selatom
      coor stat sele JUNK .and. type C5 end
      set atom4 = ?selatom
      coor stat sele JUNK .and. type C6 end
      set atom5 = ?selatom

      calc index0 = @atom0 - 1
      calc index1 = @atom1 - 1
      calc index2 = @atom2 - 1
      calc index3 = @atom3 - 1
      calc index4 = @atom4 - 1
      calc index5 = @atom5 - 1

      write title unit 54
      * @index0 @index1 @index2 @index3 60.0 2.5
      * @index1 @index2 @index3 @index4 -60.0 2.5
      * @index2 @index3 @index4 @index5 60.0 2.5
      * @index3 @index4 @index5 @index0 -60.0 2.5
      * @index4 @index5 @index0 @index1 60.0 2.5
      * @index5 @index0 @index1 @index2 -60.0 2.5
      *

      goto donext
   endif

!
! Other sugar chair conformation
!

   coor stat sele JUNK .and. type O5 end
   set atom0 = ?selatom
   coor stat sele JUNK .and. type C1 end
   set atom1 = ?selatom
   coor stat sele JUNK .and. type C2 end
   set atom2 = ?selatom
   coor stat sele JUNK .and. type C3 end
   set atom3 = ?selatom
   coor stat sele JUNK .and. type C4 end
   set atom4 = ?selatom
   coor stat sele JUNK .and. type C5 end
   set atom5 = ?selatom

   calc index0 = @atom0 - 1
   calc index1 = @atom1 - 1
   calc index2 = @atom2 - 1
   calc index3 = @atom3 - 1
   calc index4 = @atom4 - 1
   calc index5 = @atom5 - 1

   write title unit 54
   * @index0 @index1 @index2 @index3 60.0 2.5
   * @index1 @index2 @index3 @index4 -60.0 2.5
   * @index2 @index3 @index4 @index5 60.0 2.5
   * @index3 @index4 @index5 @index0 -60.0 2.5
   * @index4 @index5 @index0 @index1 60.0 2.5
   * @index5 @index0 @index1 @index2 -60.0 2.5
   *

   label donext

incr iatom by @nresatom
incr icnt by 1
if icnt .le. @cntmax goto DOCARB

label skipcarb